---
phase: 04-animation
plan: 04
type: execute
wave: 3
depends_on: ["04-01", "04-03"]
files_modified:
  - src/components/sections/ProjectDetail.tsx
  - src/components/sections/DraggableGallery.tsx
  - src/components/sections/Projects.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Project detail expands inline below cards (no modal)"
    - "Section opens with height animation, then content wipes in from right"
    - "Switching projects cross-fades content (section stays open)"
    - "Gallery is horizontally draggable with momentum"
    - "Gallery images bleed outside content frame"
    - "Projects section border-radius animates when detail opens"
  artifacts:
    - path: "src/components/sections/ProjectDetail.tsx"
      provides: "Inline project detail with case study content"
      exports: ["ProjectDetail"]
    - path: "src/components/sections/DraggableGallery.tsx"
      provides: "Horizontal drag carousel with momentum"
      exports: ["DraggableGallery"]
    - path: "src/components/sections/Projects.tsx"
      provides: "Projects section with inline expansion instead of modal"
      contains: "AnimatePresence"
  key_links:
    - from: "src/components/sections/Projects.tsx"
      to: "src/components/sections/ProjectDetail.tsx"
      via: "Component import and conditional render"
      pattern: "selectedProject.*ProjectDetail"
    - from: "src/components/sections/ProjectDetail.tsx"
      to: "src/components/sections/DraggableGallery.tsx"
      via: "Component import for gallery"
      pattern: "<DraggableGallery"
---

<objective>
Replace modal project view with inline expansion featuring draggable gallery carousel.

Purpose: Major UX improvement - keeps user in context instead of modal overlay. Gallery carousel provides tactile exploration. Animation choreography (expand -> wipe) creates premium feel.

Output: ProjectDetail inline expansion, DraggableGallery carousel, updated Projects section, page layout adjusted
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-animation/04-CONTEXT.md
@.planning/phases/04-animation/04-RESEARCH.md
@.planning/phases/04-animation/04-01-SUMMARY.md
@.planning/phases/04-animation/04-03-SUMMARY.md
@src/components/sections/Projects.tsx
@src/components/sections/ProjectModal.tsx
@src/app/page.tsx
@src/types/project.ts
@src/data/projects.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DraggableGallery carousel component</name>
  <files>
    - src/components/sections/DraggableGallery.tsx
  </files>
  <action>
Create `src/components/sections/DraggableGallery.tsx`:

1. 'use client' directive

2. Props interface:
   ```tsx
   interface DraggableGalleryProps {
     images: string[]
     projectTitle: string
   }
   ```

3. Imports:
   - `import { useRef, useState, useEffect } from 'react'`
   - `import { m } from 'motion/react'`
   - `import Image from 'next/image'`

4. Calculate drag constraints:
   - containerRef for outer overflow container
   - Use useEffect to calculate scroll width vs client width
   - Set dragConstraints: { left: -(scrollWidth - clientWidth), right: 0 }

5. Render structure:
   ```tsx
   <div ref={containerRef} className="overflow-hidden">
     <m.div
       drag="x"
       dragConstraints={dragConstraints}
       dragElastic={0.1}
       dragMomentum={true}
       dragTransition={{
         bounceStiffness: 300,
         bounceDamping: 30,
       }}
       className="flex gap-4 cursor-grab active:cursor-grabbing"
     >
       {images.map((src, i) => (
         <div
           key={i}
           className="flex-shrink-0 w-[85%] sm:w-[70%] aspect-[21/9] relative rounded-lg overflow-hidden"
         >
           <Image
             src={src}
             alt={`${projectTitle} screenshot ${i + 1}`}
             fill
             className="object-cover"
             sizes="85vw"
           />
         </div>
       ))}
     </m.div>
   </div>
   ```

6. Gallery bleeds outside frame:
   - Container has negative margins: -mx-4 sm:-mx-8
   - First/last items have padding to center first image

7. Add drag hint:
   - Small "drag to explore" text or visual cue on first render
   - Fades after user drags
  </action>
  <verify>
    - `ls src/components/sections/DraggableGallery.tsx` exists
    - `grep -q "drag=\"x\"" src/components/sections/DraggableGallery.tsx`
    - `grep -q "dragMomentum" src/components/sections/DraggableGallery.tsx`
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
    DraggableGallery component with horizontal drag, momentum physics, and bleed effect.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ProjectDetail inline expansion component</name>
  <files>
    - src/components/sections/ProjectDetail.tsx
  </files>
  <action>
Create `src/components/sections/ProjectDetail.tsx`:

1. 'use client' directive

2. Props interface:
   ```tsx
   interface ProjectDetailProps {
     project: Project
     onClose: () => void
   }
   ```

3. Imports:
   - `import { m } from 'motion/react'`
   - `import { X, ExternalLink, Github } from 'lucide-react'`
   - `import { DraggableGallery } from './DraggableGallery'`
   - `import type { Project } from '@/types/project'`
   - `import { isLiveProject } from '@/types/project'`

4. Content structure (similar to ProjectModal but different layout):
   - Close button (X) in top right
   - Gallery first (full-bleed with DraggableGallery)
   - Below gallery: two-column layout on desktop
     - Left: Title, tagline, technologies
     - Right: Challenge, Approach, Result narrative
   - CTAs at bottom

5. Content wipe animation (handled by parent, but component provides structure):
   - Wrapper m.div with initial={{ opacity: 0, x: 50 }}
   - animate={{ opacity: 1, x: 0 }}
   - transition={{ delay: 0.2, duration: 0.3, ease: 'easeOut' }}

6. Styling:
   - Background: bg-text-primary (cream, matching footer)
   - Text: text-base-900 (dark text on cream)
   - Accent: amber-600 (darker amber for contrast)
   - Padding: generous whitespace
   - Max-width container for content (gallery bleeds)
  </action>
  <verify>
    - `ls src/components/sections/ProjectDetail.tsx` exists
    - `grep -q "DraggableGallery" src/components/sections/ProjectDetail.tsx`
    - `grep -q "onClose" src/components/sections/ProjectDetail.tsx`
    - `grep -q "bg-text-primary" src/components/sections/ProjectDetail.tsx` (cream background)
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
    ProjectDetail component with cream background, draggable gallery, case study narrative, and close button.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire inline expansion into Projects section and page</name>
  <files>
    - src/components/sections/Projects.tsx
    - src/app/page.tsx
  </files>
  <action>
**Projects.tsx - Major refactor:**

1. Remove ProjectModal import and usage

2. Add imports:
   - `import { m, AnimatePresence } from 'motion/react'`
   - `import { ProjectDetail } from './ProjectDetail'`

3. Keep existing selectedProject state

4. Update section structure for inline expansion:
   - Wrap entire section in a fragment or div
   - Main section (with cards) gets animated border-radius
   - Detail section appears BELOW cards section when project selected

5. Border-radius animation on cards section:
   ```tsx
   <m.section
     id="projects"
     className="py-[var(--spacing-section)]"
     animate={{
       borderBottomLeftRadius: selectedProject ? '1.5rem' : 0,
       borderBottomRightRadius: selectedProject ? '1.5rem' : 0,
     }}
     transition={{ duration: 0.3, ease: 'easeOut' }}
   >
     {/* existing content */}
   </m.section>
   ```

6. Add inline detail section with AnimatePresence:
   ```tsx
   <AnimatePresence mode="wait">
     {selectedProject && (
       <m.div
         key={selectedProject.id}
         initial={{ height: 0, opacity: 0 }}
         animate={{ height: 'auto', opacity: 1 }}
         exit={{ height: 0, opacity: 0 }}
         transition={{ duration: 0.35, ease: 'easeOut' }}
         className="overflow-hidden"
       >
         <ProjectDetail
           project={selectedProject}
           onClose={() => setSelectedProject(null)}
         />
       </m.div>
     )}
   </AnimatePresence>
   ```

7. Export a wrapper component that includes both sections

**page.tsx:**

Update to accommodate the new Projects structure:
- Projects component now manages its own expansion area
- May need to adjust the rounded card container to allow detail to expand outside
- Check that footer still appears below the detail section

Consider: The detail section with cream background should flow into the footer area (both cream). This might require restructuring page.tsx to have Projects expand into the footer zone.

Alternative approach if needed:
- Projects component returns fragment with cards section + detail section
- page.tsx renders them within the main card, but detail breaks out with negative margins
- Use z-index and positioning to achieve visual effect
  </action>
  <verify>
    - `grep -q "ProjectModal" src/components/sections/Projects.tsx` returns 1 (no longer used)
    - `grep -q "AnimatePresence" src/components/sections/Projects.tsx`
    - `grep -q "ProjectDetail" src/components/sections/Projects.tsx`
    - `grep -q "borderBottomLeftRadius" src/components/sections/Projects.tsx` (animated radius)
    - App renders without errors
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
    Projects section uses inline expansion instead of modal. Height animates open, content wipes in. Switching projects cross-fades. Border-radius animates on cards section.
  </done>
</task>

</tasks>

<verification>
1. Inline expansion behavior:
   - Clicking project card opens detail section below cards
   - Section height animates open first
   - Content wipes in from right after height settles
   - Clicking different project cross-fades content
   - Close button collapses section with reverse animation

2. Gallery carousel:
   - Drag horizontally with finger/mouse
   - Has momentum (continues after release)
   - Bounces at edges
   - Images bleed outside content frame

3. Visual polish:
   - Cards section border-radius animates to 2xl when detail opens
   - Detail section has cream background matching footer
   - Smooth transitions throughout

4. Code cleanup:
   - ProjectModal no longer imported in Projects.tsx
   - No TypeScript errors
</verification>

<success_criteria>
- Modal completely replaced by inline expansion
- Height animation precedes content wipe-in
- Cross-fade when switching projects (section stays expanded)
- DraggableGallery has momentum and bleed
- Projects section border-radius animates
- Close button works to collapse detail
- ProjectModal.tsx can remain in codebase (unused) or be deleted
</success_criteria>

<output>
After completion, create `.planning/phases/04-animation/04-04-SUMMARY.md`
</output>
