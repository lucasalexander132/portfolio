---
phase: 13-navigation-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/Navigation.tsx
  - src/components/layout/Footer.tsx
autonomous: true

must_haves:
  truths:
    - "Updates link appears in the nav bar alongside Services and Projects"
    - "Updates link appears in the Footer quick links section"
    - "On the homepage, clicking Services/Projects still smooth-scrolls to those sections"
    - "On /updates, clicking Services/Projects navigates to /#services and /#projects"
    - "On /updates, clicking the logo navigates to / instead of scrolling to #hero"
  artifacts:
    - path: "src/components/layout/Navigation.tsx"
      provides: "Route-aware navigation with Updates link"
      contains: "usePathname"
    - path: "src/components/layout/Footer.tsx"
      provides: "Footer with Updates quick link and route-aware anchor links"
      contains: "updates"
  key_links:
    - from: "src/components/layout/Navigation.tsx"
      to: "next/navigation"
      via: "usePathname import"
      pattern: "usePathname"
    - from: "src/components/layout/Navigation.tsx"
      to: "next/link"
      via: "Link component for Updates"
      pattern: "Link.*updates"
    - from: "src/components/layout/Footer.tsx"
      to: "/updates"
      via: "Link in quick links"
      pattern: "updates"
---

<objective>
Make Navigation.tsx route-aware (smooth-scroll on homepage, route navigation elsewhere) and add "Updates" link to both Navigation and Footer.

Purpose: This is the highest-risk change in v1.2 -- modifying the existing Navigation component that works on the homepage. The nav must detect which page it's on via `usePathname()` and handle anchor links differently: scroll on homepage, navigate on other pages.
Output: Route-aware Navigation.tsx with Updates link, Footer.tsx with Updates quick link.
</objective>

<execution_context>
@/Users/lucasalexander/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucasalexander/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/layout/Navigation.tsx
@src/components/layout/Footer.tsx
@src/app/page.tsx
@messages/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make Navigation.tsx route-aware and add Updates link</name>
  <files>src/components/layout/Navigation.tsx</files>
  <action>
    Modify `src/components/layout/Navigation.tsx` with these specific changes:

    1. **Add imports:**
       - `import { usePathname } from 'next/navigation'` (NOT `useRouter` -- we only need pathname for detection)
       - `import Link from 'next/link'`

    2. **Add Updates to navItems array:**
       Current navItems has `#services` and `#projects`. Add a third item:
       ```typescript
       { href: '/updates', labelKey: 'nav.updates' as const, cursorKey: 'cursor.latest_updates' as const }
       ```
       Note: This item has a `/` path prefix, not `#`. The rendering logic must handle both types.

    3. **Add pathname detection inside the component:**
       ```typescript
       const pathname = usePathname()
       const isHome = pathname === '/'
       ```

    4. **Update handleClick to be route-aware:**
       ```typescript
       const handleClick = (e: React.MouseEvent<HTMLAnchorElement>, href: string) => {
         if (href.startsWith('#')) {
           if (isHome) {
             // On homepage: smooth scroll (existing behavior)
             e.preventDefault()
             const targetId = href.replace('#', '')
             const target = document.getElementById(targetId)
             if (target) {
               target.scrollIntoView({ behavior: 'smooth', block: 'start' })
             }
           } else {
             // On other pages: let the browser navigate to /#section
             // No preventDefault -- the href will be set to `/${href}` below
           }
         }
         // For non-hash links like /updates: let Link handle it (no handler needed)
       }
       ```

    5. **Update the nav link rendering in the JSX:**
       The current `{navItems.map(...)}` renders `<m.a>` elements. Change the rendering to handle both link types:

       For hash links (`href.startsWith('#')`):
       - On homepage: render `<m.a href={href} onClick={handleClick}>` (existing scroll behavior)
       - Off homepage: render `<Link href={`/${href}`}>` wrapped in `<m.div>` for animation (navigates to `/#services`)

       For route links (like `/updates`):
       - Render `<Link href={href}>` wrapped in `<m.div>` for animation

       Implementation approach -- use a single map with conditional rendering:
       ```tsx
       {navItems.map(({ href, labelKey, cursorKey }) => {
         const isHashLink = href.startsWith('#')
         const linkHref = isHashLink && !isHome ? `/${href}` : href
         const className = "block px-4 py-2 text-sm rounded-lg text-amber-500 border border-amber-500/50 bg-base-900 hover:bg-base-800 hover:border-amber-400 transition-colors"

         return (
           <li key={href}>
             {isHashLink && isHome ? (
               <m.a
                 href={href}
                 onClick={(e) => handleClick(e, href)}
                 className={className}
                 onMouseEnter={() => setCursorVariant('text', t(cursorKey), true)}
                 onMouseLeave={resetCursor}
               >
                 {t(labelKey)}
               </m.a>
             ) : (
               <Link
                 href={linkHref}
                 className={className}
                 onMouseEnter={() => setCursorVariant('text', t(cursorKey), true)}
                 onMouseLeave={resetCursor}
               >
                 {t(labelKey)}
               </Link>
             )}
           </li>
         )
       })}
       ```

    6. **Update the logo link:**
       The logo `<a href="#hero" onClick={handleClick}>` must also be route-aware:
       - On homepage: keep existing scroll-to-top behavior
       - Off homepage: use `<Link href="/">` to navigate home

       ```tsx
       {isHome ? (
         <a
           href="#hero"
           onClick={(e) => handleClick(e, '#hero')}
           className="flex items-center justify-center w-10 h-10 rounded-lg bg-text-primary text-base-950 font-serif text-lg font-medium hover:bg-amber-400 transition-colors"
           onMouseEnter={() => setCursorVariant('link', undefined, true, 'up')}
           onMouseLeave={resetCursor}
         >
           C.
         </a>
       ) : (
         <Link
           href="/"
           className="flex items-center justify-center w-10 h-10 rounded-lg bg-text-primary text-base-950 font-serif text-lg font-medium hover:bg-amber-400 transition-colors"
           onMouseEnter={() => setCursorVariant('link', undefined, true, 'up')}
           onMouseLeave={resetCursor}
         >
           C.
         </Link>
       )}
       ```

    7. **Keep ContactForm and openContactForm listener unchanged.** The contact button (mail icon) works the same on all pages -- it toggles the form overlay.

    IMPORTANT: Preserve all existing behavior exactly. The `isFormOpen` state, escape key handler, `openContactForm` event listener, contact button, and LanguageSwitcher must remain untouched.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Navigation.tsx contains `usePathname` import
    - Navigation.tsx contains `/updates` in navItems
    - Navigation.tsx contains `isHome` conditional logic
  </verify>
  <done>
    - "Updates" link appears in nav bar next to Services and Projects
    - On homepage: Services and Projects smooth-scroll, Updates navigates to /updates
    - On /updates: Services links to /#services, Projects links to /#projects, logo links to /
    - Contact mail button still toggles the form overlay on all pages
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Updates link and route-awareness to Footer</name>
  <files>src/components/layout/Footer.tsx</files>
  <action>
    Modify `src/components/layout/Footer.tsx` with these changes:

    1. **Add imports:**
       - `import { usePathname } from 'next/navigation'`
       - `import Link from 'next/link'`

    2. **Add "Updates" to the quickLinks array:**
       ```typescript
       const quickLinks = [
         { href: '#services', labelKey: 'nav.services' as const, cursorKey: 'footer.cursor.services' as const },
         { href: '#projects', labelKey: 'nav.projects' as const, cursorKey: 'footer.cursor.projects' as const },
         { href: '/updates', labelKey: 'nav.updates' as const, cursorKey: 'footer.cursor.updates' as const },
       ]
       ```

    3. **Add pathname detection inside the Footer component:**
       ```typescript
       const pathname = usePathname()
       const isHome = pathname === '/'
       ```

    4. **Update handleNavClick to be route-aware** (same pattern as Navigation):
       - On homepage with hash links: smooth scroll (existing behavior)
       - Off homepage with hash links: navigate to `/#section`
       - Route links like `/updates`: handled by Link component

    5. **Update quick links rendering:**
       Same conditional pattern as Navigation -- use `<a>` with scroll for hash links on homepage, `<Link>` for everything else:
       ```tsx
       {quickLinks.map(({ href, labelKey, cursorKey }) => {
         const isHashLink = href.startsWith('#')

         return (
           <li key={href}>
             {isHashLink && isHome ? (
               <a
                 href={href}
                 onClick={(e) => handleNavClick(e, href)}
                 className="text-base-700 hover:text-amber-500 transition-colors text-sm font-semibold"
                 onMouseEnter={() => setCursorVariant('text', t(cursorKey), true)}
                 onMouseLeave={resetCursor}
               >
                 {t(labelKey)}
               </a>
             ) : (
               <Link
                 href={isHashLink ? `/${href}` : href}
                 className="text-base-700 hover:text-amber-500 transition-colors text-sm font-semibold"
                 onMouseEnter={() => setCursorVariant('text', t(cursorKey), true)}
                 onMouseLeave={resetCursor}
               >
                 {t(labelKey)}
               </Link>
             )}
           </li>
         )
       })}
       ```

    6. **Keep the Contact button unchanged.** It uses `window.dispatchEvent(new CustomEvent('openContactForm'))` which works on any page since Navigation listens for it.

    IMPORTANT: Preserve all existing Footer structure -- brand column, social links, bottom bar. Only modify the quick links section.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Footer.tsx contains `usePathname` import
    - Footer.tsx quickLinks array contains `/updates` entry
  </verify>
  <done>
    - "Updates" link appears in Footer quick links section
    - On homepage: Services and Projects footer links smooth-scroll
    - On /updates: Services and Projects footer links navigate to /#services and /#projects
    - Contact button in footer still dispatches openContactForm event
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npm run build` completes successfully
- Navigation.tsx uses `usePathname()` for route detection
- Footer.tsx uses `usePathname()` for route detection
- Both components have "Updates" link
- Existing homepage scroll behavior logic is preserved (conditional on `isHome`)
</verification>

<success_criteria>
- "Updates" link visible in both Navigation and Footer
- Homepage anchor scroll behavior unchanged (Services, Projects still smooth-scroll)
- Off-homepage anchor links navigate to /#section URLs
- Logo navigates to / when not on homepage
- No TypeScript errors, build passes
</success_criteria>

<output>
After completion, create `.planning/phases/13-navigation-integration/13-02-SUMMARY.md`
</output>
