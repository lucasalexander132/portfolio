---
phase: 06-translation-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/lib/i18n.tsx
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Calling useTranslations() returns a typed t() function"
    - "Calling useLocale() returns current locale and setLocale function"
    - "Site detects browser language on initial load and sets French if navigator.language starts with 'fr'"
    - "LocaleProvider wraps the entire app in layout.tsx"
  artifacts:
    - path: "src/lib/i18n.tsx"
      provides: "LocaleProvider, useLocale, useTranslations hooks"
      exports: ["LocaleProvider", "useLocale", "useTranslations"]
      min_lines: 50
    - path: "src/app/layout.tsx"
      provides: "Root layout with LocaleProvider wrapping all providers"
      contains: "LocaleProvider"
  key_links:
    - from: "src/lib/i18n.tsx"
      to: "messages/en.json"
      via: "import statement"
      pattern: "import en from.*messages/en\\.json"
    - from: "src/lib/i18n.tsx"
      to: "messages/fr.json"
      via: "import statement"
      pattern: "import fr from.*messages/fr\\.json"
    - from: "src/lib/i18n.tsx"
      to: "src/types/i18n.d.ts"
      via: "type import"
      pattern: "import.*TranslationKey.*from.*i18n"
    - from: "src/app/layout.tsx"
      to: "src/lib/i18n.tsx"
      via: "import and use"
      pattern: "LocaleProvider"
---

<objective>
Create the LocaleProvider with type-safe translation function and integrate it into the app layout.

Purpose: This is the core infrastructure for i18n. Once complete, any component can use useTranslations() to get a type-safe t() function, and useLocale() to read or change the current language.

Output: src/lib/i18n.tsx with LocaleProvider and hooks, src/app/layout.tsx updated to wrap app with LocaleProvider.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-translation-infrastructure/06-RESEARCH.md
@.planning/phases/06-translation-infrastructure/06-01-SUMMARY.md
@src/components/cursor/CursorContext.tsx
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LocaleProvider with type-safe translation function</name>
  <files>src/lib/i18n.tsx</files>
  <action>
Create src/lib/i18n.tsx following the pattern established in CursorContext.tsx.

1. Add 'use client' directive at top

2. Import dependencies:
```typescript
import {
  createContext,
  useContext,
  useState,
  useEffect,
  useCallback,
  type ReactNode,
} from 'react'
import en from '../../messages/en.json'
import fr from '../../messages/fr.json'
import type { TranslationKey } from '@/types/i18n'
```

3. Define types:
```typescript
type Locale = 'en' | 'fr'

const messages = { en, fr } as const

interface LocaleContextValue {
  locale: Locale
  setLocale: (locale: Locale) => void
  t: (key: TranslationKey) => string
}
```

4. Create context:
```typescript
const LocaleContext = createContext<LocaleContextValue | null>(null)
```

5. Create LocaleProvider component:
- useState for locale, default 'en'
- useEffect to detect browser language on mount:
  ```typescript
  useEffect(() => {
    const browserLang = navigator.language.split('-')[0]
    if (browserLang === 'fr') {
      setLocale('fr')
    }
  }, [])
  ```
- useCallback for t() function that:
  - Splits key by '.' to traverse nested object
  - Returns the translated string
  - Falls back to returning the key if not found (visible bug indicator)
- Return Provider with value={{ locale, setLocale, t }}

6. Export useLocale hook:
- Returns { locale, setLocale } from context
- Throws if used outside provider

7. Export useTranslations hook:
- Returns t function from context
- Throws if used outside provider

Follow CursorContext.tsx style: same import structure, same error message pattern, same hook export style.
  </action>
  <verify>
`npx tsc --noEmit` passes without errors related to i18n.tsx.
File exports LocaleProvider, useLocale, useTranslations.
  </verify>
  <done>
src/lib/i18n.tsx exists with LocaleProvider component and useLocale/useTranslations hooks exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate LocaleProvider into app layout</name>
  <files>src/app/layout.tsx</files>
  <action>
Modify src/app/layout.tsx to wrap the app with LocaleProvider.

1. Add import at top:
```typescript
import { LocaleProvider } from '@/lib/i18n'
```

2. Wrap LocaleProvider as the OUTERMOST provider in the body:
```typescript
<body className="bg-base-950 text-text-primary">
  <LocaleProvider>
    <MotionProvider>
      <CursorProvider>
        <CustomCursor />
        {children}
      </CursorProvider>
    </MotionProvider>
  </LocaleProvider>
</body>
```

Rationale: LocaleProvider must be outermost so all other components (including MotionProvider, CursorProvider, and page content) can access translations.

Note: Keep lang="en" on html element for now. Phase 7 (Language Switcher) will make this dynamic when the switcher is built.
  </action>
  <verify>
`npx tsc --noEmit` passes.
layout.tsx contains LocaleProvider import and usage.
Dev server starts without errors (user will verify - do not run dev server yourself).
  </verify>
  <done>
src/app/layout.tsx wraps all content with LocaleProvider as outermost provider.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npx tsc --noEmit` passes without errors
2. LocaleProvider exports are available from '@/lib/i18n'
3. layout.tsx has correct provider nesting order
4. No runtime errors when app loads (user verification)
</verification>

<success_criteria>
- useTranslations() returns typed t() function when called from any client component
- useLocale() returns { locale, setLocale } for reading and changing language
- Browser language detection runs on mount (French browser sees French, others see English)
- TypeScript enforces valid translation keys (misspelled keys cause compile errors)
- App loads without errors with new provider hierarchy
</success_criteria>

<output>
After completion, create `.planning/phases/06-translation-infrastructure/06-02-SUMMARY.md`
</output>
