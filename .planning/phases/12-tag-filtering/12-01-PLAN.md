---
phase: 12-tag-filtering
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/updates/page.tsx
  - src/components/updates/TagFilter.tsx
  - src/components/updates/UpdatesPageContent.tsx
  - src/components/updates/EntryStreamContainer.tsx
  - messages/en.json
  - messages/fr.json
autonomous: true

must_haves:
  truths:
    - "Clicking a tag chip filters the stream to show only entries with that tag"
    - "Clicking the active tag chip again clears the filter and shows all entries"
    - "The active filter is stored in the URL as ?tag=X, making filtered views shareable"
    - "TagFilter uses Suspense boundary so there are no hydration errors"
    - "Animation replays when filter changes"
  artifacts:
    - path: "src/components/updates/TagFilter.tsx"
      provides: "Client component for tag URL param manipulation"
      exports: ["default"]
    - path: "src/app/updates/page.tsx"
      provides: "Server-side searchParams reading and entry filtering"
      contains: "await searchParams"
    - path: "src/components/updates/UpdatesPageContent.tsx"
      provides: "TagFilter rendered inside Suspense boundary"
      contains: "Suspense"
  key_links:
    - from: "src/app/updates/page.tsx"
      to: "src/components/updates/UpdatesPageContent.tsx"
      via: "passes filtered entries and activeTag prop"
      pattern: "activeTag"
    - from: "src/components/updates/UpdatesPageContent.tsx"
      to: "src/components/updates/TagFilter.tsx"
      via: "renders TagFilter inside Suspense"
      pattern: "Suspense.*TagFilter"
    - from: "src/components/updates/EntryStreamContainer.tsx"
      to: "animation replay"
      via: "key prop changes on filter change"
      pattern: "key="
---

<objective>
Add tag-based filtering to the /updates page so visitors can filter the entry stream by clicking tag chips, with the active filter stored in the URL as ?tag=X for shareable, bookmarkable filtered views.

Purpose: Lets visitors quickly find entries by topic (project-launch, design-thinking, business, community, learning) and share filtered views with others.
Output: TagFilter client component, server-side filtering in page.tsx, Suspense wrapping, animation replay on filter change, i18n labels.
</objective>

<execution_context>
@/Users/lucasalexander/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucasalexander/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/updates.ts
@src/app/updates/page.tsx
@src/components/updates/UpdatesPageContent.tsx
@src/components/updates/EntryStreamContainer.tsx
@src/components/updates/TagChip.tsx
@messages/en.json
@messages/fr.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TagFilter component and add i18n keys</name>
  <files>
    src/components/updates/TagFilter.tsx
    messages/en.json
    messages/fr.json
  </files>
  <action>
Create `src/components/updates/TagFilter.tsx` as a `'use client'` component:

1. Import `useSearchParams`, `useRouter`, `usePathname` from `next/navigation`
2. Import `UPDATE_TAGS` and `UpdateTag` from `@/lib/updates`
3. Import `TAG_STYLES` from `./TagChip` (reuse existing color definitions)
4. Import `useTranslations` from `@/lib/i18n`

The component renders a row of tag buttons with `role="group"` and `aria-label` from translations:
- Map over `UPDATE_TAGS` to render a button for each tag
- Each button uses the same pill styling as TagChip (`px-2.5 py-0.5 rounded-full text-xs font-medium border`) but as a `<button>` not `<span>`
- Apply `TAG_STYLES[tag]` colors. When a tag is active (matches `searchParams.get('tag')`), apply the tag's `bg` color. When inactive, use `bg-transparent` with the tag's `text` and `border` colors
- Add `aria-pressed={activeTag === tag}` to each button
- Add a subtle hover state: `hover:opacity-80 transition-opacity`
- On click: if the clicked tag is already active, remove `?tag` param (toggle off). Otherwise set `?tag=X`. Use `router.push()` with the constructed URL
- Format tag labels using the same logic as TagChip: replace hyphens with spaces, capitalize first letter

Also add an "All" button at the start that clears the filter (removes ?tag param). Style it with `bg-base-800 text-text-primary border-base-700` when no filter is active, and `bg-transparent text-text-muted border-base-700` when a filter is active.

Add i18n keys to both translation files:
- `updates.filter.label` -- EN: "Filter by tag", FR: "Filtrer par sujet"
- `updates.filter.all` -- EN: "All", FR: "Tout"
- `updates.filter.noEntries` -- EN: "No entries with this tag yet.", FR: "Aucune mise a jour avec ce sujet pour le moment."
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
  </verify>
  <done>
TagFilter.tsx exists as a client component that reads/writes URL search params, renders styled tag buttons with aria attributes, and translation keys exist in both en.json and fr.json.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire filtering into page.tsx and UpdatesPageContent</name>
  <files>
    src/app/updates/page.tsx
    src/components/updates/UpdatesPageContent.tsx
    src/components/updates/EntryStreamContainer.tsx
  </files>
  <action>
**Modify `src/app/updates/page.tsx`:**
1. Add `searchParams` to the page props as `searchParams: Promise<{ tag?: string }>` (Next.js 16 async params)
2. `await searchParams` to get `{ tag }`
3. Validate `tag` against `UPDATE_TAGS` -- if present and valid, cast to `UpdateTag`; otherwise treat as `null` (no filter)
4. Filter `entries` server-side: if `activeTag` is non-null, filter to entries where `e.tag === activeTag`
5. Pass both `entries` (filtered) and `activeTag` (string | null) to `UpdatesPageContent`

**Modify `src/components/updates/UpdatesPageContent.tsx`:**
1. Add `activeTag: string | null` to the props interface
2. Import `Suspense` from `react`
3. Import `TagFilter` from `./TagFilter`
4. Render `TagFilter` wrapped in `<Suspense>` with a skeleton fallback between the `<h1>` and `<NowSection>`:
   - Skeleton: a `<div className="flex gap-2 mb-6">` with 6 placeholder pills (`h-7 w-16 rounded-full bg-base-800 animate-pulse`)
5. Pass `activeTag` to `EntryStreamContainer`
6. Below `EntryStreamContainer`, if `entries.length === 0` and `activeTag` is non-null, show the "no entries" empty state message using `t('updates.filter.noEntries')` -- styled as `text-text-muted text-center py-12`

**Modify `src/components/updates/EntryStreamContainer.tsx`:**
1. Add `activeTag?: string | null` to props interface
2. Add `key={activeTag ?? 'all'}` to the outer `<m.div>` so the stagger animation replays when the filter changes. Since `key` cannot be passed as a prop to the component itself from the parent (it's a React special prop), instead: in `UpdatesPageContent.tsx`, wrap the `<EntryStreamContainer>` with a `key={activeTag ?? 'all'}` on a parent element. This forces remount and animation replay.

Actually, the cleaner approach: in `UpdatesPageContent.tsx`, apply the `key` directly on `<EntryStreamContainer key={activeTag ?? 'all'} entries={entries} />`. React's `key` prop works on any JSX element to force remount. No changes needed to EntryStreamContainer.tsx itself.

So the only change to EntryStreamContainer.tsx is NOT needed. Remove it from this task's file list -- the `key` prop is applied in UpdatesPageContent.tsx.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. Visit `/updates` -- all entries visible, TagFilter row appears with "All" + 5 tag buttons
3. Click a tag (e.g., "Learning") -- URL changes to `?tag=learning`, only learning entries show, animation replays
4. Click "Learning" again -- URL returns to `/updates`, all entries show
5. Click "All" button -- same behavior as clearing filter
6. Visit `/updates?tag=invalid-tag` -- shows all entries (invalid tag ignored)
7. Visit `/updates?tag=business` directly -- shows only business entries (shareable URL works)
  </verify>
  <done>
Server-side filtering works via searchParams. TagFilter is wrapped in Suspense. Animation replays on filter change. Invalid tags are gracefully ignored. Filtered URLs are shareable and bookmarkable.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- zero type errors
2. `/updates` shows all entries with TagFilter visible
3. Clicking a tag filters entries and updates URL to `?tag=X`
4. Clicking active tag clears filter and removes `?tag` from URL
5. Direct navigation to `/updates?tag=learning` shows filtered results
6. Invalid `?tag=garbage` shows all entries (no crash)
7. No hydration errors in browser console (Suspense boundary working)
8. Stagger animation replays when switching between filters
9. Tag filter label and empty state display correctly in both EN and FR
</verification>

<success_criteria>
- TagFilter client component exists with Suspense wrapping
- Server-side filtering via async searchParams in page.tsx
- URL reflects active filter as ?tag=X
- Toggle behavior: click to filter, click again to clear
- Invalid tags gracefully fall back to showing all entries
- i18n labels work in both English and French
- Stagger animation replays on filter change
- Zero hydration errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-tag-filtering/12-01-SUMMARY.md`
</output>
